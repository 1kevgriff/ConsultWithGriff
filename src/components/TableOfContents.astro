---
interface Props {
  headings: Array<{ depth: number; slug: string; text: string }>;
  formattedDate: string;
  readingTime: number;
}

const { headings, formattedDate, readingTime } = Astro.props;

// Filter to H2 and H3 only
const tocHeadings = headings.filter((h) => h.depth === 2 || h.depth === 3);
---

<nav class="sticky top-20 max-h-[calc(100vh-5rem)]" aria-label="Table of contents">
  <div class="bg-white border border-navy-200 rounded-lg p-6 shadow-sm">
    <!-- Metadata Section -->
    <div class="border-b border-navy-200 pb-4 mb-4">
      <p class="text-xs uppercase tracking-wide text-navy-600 font-semibold">Published</p>
      <p class="text-sm text-navy-800 mt-1">{formattedDate}</p>

      <p class="text-xs uppercase tracking-wide text-navy-600 font-semibold mt-3">Reading Time</p>
      <p class="text-sm text-navy-800 mt-1">{readingTime} min read</p>
    </div>

    <!-- TOC Heading -->
    <h2 class="text-sm uppercase tracking-wide text-navy-600 font-semibold mb-3">On This Page</h2>

    <!-- TOC Links -->
    <ul class="space-y-0 overflow-y-auto max-h-[60vh]">
      {
        tocHeadings.map((heading) => (
          <li>
            <a
              href={`#${heading.slug}`}
              data-toc-link
              data-target={heading.slug}
              class:list={[
                'block py-1.5 text-sm transition-colors border-l-2 border-transparent pl-3 -ml-3',
                heading.depth === 2
                  ? 'font-semibold text-navy-800'
                  : 'pl-6 font-normal text-navy-600',
                'hover:text-gold hover:border-gold',
              ]}
            >
              {heading.text}
            </a>
          </li>
        ))
      }
    </ul>
  </div>
</nav>
